!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("prop-types"),require("react"),require("core-js/fn/array/find"),require("core-js/fn/object/assign"),require("clone"),require("d3-ease"),require("d3-hierarchy")):"function"==typeof define&&define.amd?define(["prop-types","react","core-js/fn/array/find","core-js/fn/object/assign","clone","d3-ease","d3-hierarchy"],r):e.ReactTreeGraph=r(e.PropTypes,e.React,null,null,e.clone,e.d3,e.d3)}(this,function(e,r,t,s,i,n,o){"use strict";var a=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,t,s){return t&&e(r.prototype,t),s&&e(r,s),r}}(),u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},c=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},l=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},d={source:e.object.isRequired,target:e.object.isRequired,keyProp:e.string.isRequired,x1:e.number.isRequired,x2:e.number.isRequired,y1:e.number.isRequired,y2:e.number.isRequired,pathProps:e.object.isRequired};var h=function(e){function t(e){a(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleClick=r.handleClick.bind(r),r}return c(t,e),p(t,[{key:"handleClick",value:function(e){this.props.pathProps.onClick&&this.props.pathProps.onClick(this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp],e)}},{key:"render",value:function(){var e,t,s,i,n=(e=this.props.x1,t=this.props.y1,s=this.props.x2,i=this.props.y2,"M"+t+","+e+"C"+(t+i)/2+","+e+" "+(t+i)/2+","+s+" "+i+","+s);return r.createElement("path",u({},this.props.pathProps,{d:n,onClick:this.handleClick}))}}]),t}(r.PureComponent);h.propTypes=d;var f={x:e.number.isRequired,y:e.number.isRequired,keyProp:e.string.isRequired,labelProp:e.string.isRequired,offset:e.number.isRequired,radius:e.number.isRequired,circleProps:e.object.isRequired,gProps:e.object.isRequired,textProps:e.object.isRequired},y=function(e){function t(e){a(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.handleClick=r.handleClick.bind(r),r}return c(t,e),p(t,[{key:"handleClick",value:function(e){this.props.gProps.onClick&&this.props.gProps.onClick(this.props[this.props.keyProp],e)}},{key:"getTransform",value:function(){return"translate("+this.props.y+", "+this.props.x+")"}},{key:"render",value:function(){return r.createElement("g",u({},this.props.gProps,{transform:this.getTransform(),onClick:this.handleClick}),r.createElement("circle",u({},this.props.circleProps,{r:this.props.radius})),r.createElement("text",u({},this.props.textProps,{dx:this.props.radius+.5,dy:this.props.offset}),this.props[this.props.labelProp]))}}]),t}(r.PureComponent);y.propTypes=f;var g={height:e.number.isRequired,keyProp:e.string.isRequired,labelProp:e.string.isRequired,links:e.array.isRequired,nodes:e.array.isRequired,nodeClassName:e.string,nodeOffset:e.number.isRequired,nodeRadius:e.number.isRequired,width:e.number.isRequired,circleProps:e.object.isRequired,gProps:e.object.isRequired,pathProps:e.object.isRequired,svgProps:e.object.isRequired,textProps:e.object.isRequired},m=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),p(t,[{key:"render",value:function(){var e=this;return r.createElement("svg",u({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.links.map(function(t){return r.createElement(h,{key:t.target.data[e.props.keyProp],keyProp:e.props.keyProp,source:t.source,target:t.target,x1:t.source.x,x2:t.target.x,y1:t.source.y,y2:t.target.y,pathProps:Object.assign({},e.props.pathProps,t.target.data.pathProps)})}),this.props.nodes.map(function(t){return r.createElement(y,u({key:t.data[e.props.keyProp],keyProp:e.props.keyProp,labelProp:e.props.labelProp,offset:e.props.nodeOffset,radius:e.props.nodeRadius,x:t.x,y:t.y,circleProps:Object.assign({},e.props.circleProps,t.data.circleProps),gProps:Object.assign({},e.props.gProps,t.data.gProps),textProps:Object.assign({},e.props.textProps,t.data.textProps)},t.data))}))}}]),t}(r.PureComponent);m.propTypes=g;var P={animated:e.bool.isRequired,getChildren:e.func.isRequired,keyProp:e.string.isRequired,links:e.array.isRequired,nodes:e.array.isRequired,duration:e.number.isRequired,easing:e.func.isRequired,steps:e.number.isRequired},b=function(e){function t(e){a(this,t);var r=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(e.animated){var s=e.nodes[0].x,i=e.nodes[0].y;r.state={nodes:e.nodes.map(function(e){return Object.assign({},e,{x:s,y:i})}),links:e.links.map(function(e){return{source:Object.assign({},e.source,{x:s,y:i}),target:Object.assign({},e.target,{x:s,y:i})}})}}else r.state={nodes:e.nodes,links:e.links};return r}return c(t,e),p(t,[{key:"componentDidMount",value:function(){this.props.animated&&this.animate(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.nodes===this.props.nodes&&e.links===this.props.links||(e.animated?this.animate(e):this.setState({nodes:e.nodes,links:e.links}))}},{key:"animate",value:function(e){var r=this;clearInterval(this.animation);var t=0,s=this.getAnimationContext(this.state,e);this.animation=setInterval(function(){if(++t===e.steps)return clearInterval(r.animation),r.animation=null,void r.setState({nodes:e.nodes,links:e.links});r.setState(r.calculateNewState(s,t/e.steps))},e.duration/e.steps)}},{key:"getAnimationContext",value:function(e,r){var t=this,s=r.nodes.filter(function(r){return e.nodes.every(function(e){return!t.areNodesSame(r,e)})}).map(function(s){return{base:s,old:t.getClosestAncestor(s,r,e),new:s}}),i=r.nodes.filter(function(r){return e.nodes.some(function(e){return t.areNodesSame(r,e)})}).map(function(r){return{base:r,old:e.nodes.find(function(e){return t.areNodesSame(r,e)}),new:r}}),n=e.nodes.filter(function(e){return r.nodes.every(function(r){return!t.areNodesSame(e,r)})}).map(function(s){return{base:s,old:s,new:t.getClosestAncestor(s,e,r)}}),o=r.links.filter(function(r){return e.links.every(function(e){return!t.areLinksSame(r,e)})}).map(function(s){return{base:s,old:t.getClosestAncestor(s.target,r,e),new:s}}),a=r.links.filter(function(r){return e.links.some(function(e){return t.areLinksSame(r,e)})}).map(function(r){return{base:r,old:e.links.find(function(e){return t.areLinksSame(r,e)}),new:r}}),p=e.links.filter(function(e){return r.links.every(function(r){return!t.areLinksSame(e,r)})}).map(function(s){return{base:s,old:s,new:t.getClosestAncestor(s.target,e,r)}});return{nodes:i.concat(s).concat(n),links:a.concat(o).concat(p)}}},{key:"getClosestAncestor",value:function(e,r,t){for(var s=this,i=e;i;){var n=t.nodes.find(function(e){return s.areNodesSame(i,e)});if(n)return n;i=r.nodes.find(function(e){return(s.props.getChildren(e)||[]).some(function(e){return s.areNodesSame(i,e)})})}return t.nodes[0]}},{key:"areNodesSame",value:function(e,r){return e.data[this.props.keyProp]===r.data[this.props.keyProp]}},{key:"areLinksSame",value:function(e,r){return e.source.data[this.props.keyProp]===r.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===r.target.data[this.props.keyProp]}},{key:"calculateNewState",value:function(e,r){var t=this;return{nodes:e.nodes.map(function(e){return t.calculateNodePosition(e.base,e.old,e.new,r)}),links:e.links.map(function(e){return t.calculateLinkPosition(e.base,e.old,e.new,r)})}}},{key:"calculateNodePosition",value:function(e,r,t,s){return Object.assign({},e,{x:this.calculateNewValue(r.x,t.x,s),y:this.calculateNewValue(r.y,t.y,s)})}},{key:"calculateLinkPosition",value:function(e,r,t,s){return{source:Object.assign({},e.source,{x:this.calculateNewValue(r.source?r.source.x:r.x,t.source?t.source.x:t.x,s),y:this.calculateNewValue(r.source?r.source.y:r.y,t.source?t.source.y:t.y,s)}),target:Object.assign({},e.target,{x:this.calculateNewValue(r.target?r.target.x:r.x,t.target?t.target.x:t.x,s),y:this.calculateNewValue(r.target?r.target.y:r.y,t.target?t.target.y:t.y,s)})}}},{key:"calculateNewValue",value:function(e,r,t){return e+(r-e)*this.props.easing(t)}},{key:"render",value:function(){return r.createElement(m,u({},this.props,this.state))}}]),t}(r.PureComponent);b.propTypes=P;var k={data:e.object.isRequired,animated:e.bool.isRequired,duration:e.number.isRequired,easing:e.func.isRequired,steps:e.number.isRequired,height:e.number.isRequired,width:e.number.isRequired,keyProp:e.string.isRequired,labelProp:e.string.isRequired,getChildren:e.func.isRequired,margins:e.shape({bottom:e.number.isRequired,left:e.number.isRequired,right:e.number.isRequired,top:e.number.isRequired}).isRequired,nodeOffset:e.number.isRequired,nodeRadius:e.number.isRequired,circleProps:e.object.isRequired,gProps:e.object.isRequired,pathProps:e.object.isRequired,svgProps:e.object.isRequired,textProps:e.object.isRequired},R={animated:!1,duration:500,easing:n.easeQuadOut,getChildren:function(e){return e.children},steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeOffset:3.5,nodeRadius:5,circleProps:{},gProps:{className:"node"},pathProps:{className:"link"},svgProps:{},textProps:{}},q=function(e){function t(){return a(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),p(t,[{key:"render",value:function(){var e=this,t=this.props.width-this.props.margins.left-this.props.margins.right,s=this.props.height-this.props.margins.top-this.props.margins.bottom,n=o.hierarchy(i(this.props.data),this.props.getChildren),a=o.tree().size([s,t])(n),p=a.descendants(),u=a.links();return p.forEach(function(r){r.y+=e.props.margins.top}),r.createElement(b,{animated:this.props.animated,duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,links:u,nodes:p,nodeOffset:this.props.nodeOffset,nodeRadius:this.props.nodeRadius,steps:this.props.steps,width:this.props.width,circleProps:this.props.circleProps,gProps:this.props.gProps,pathProps:this.props.pathProps,svgProps:this.props.svgProps,textProps:this.props.textProps})}}]),t}(r.PureComponent);return q.propTypes=k,q.defaultProps=R,q});
