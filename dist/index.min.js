!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("clone"),require("d3-ease"),require("d3-hierarchy"),require("prop-types"),require("react"),require("core-js/fn/array/find"),require("core-js/fn/object/assign")):"function"==typeof define&&define.amd?define(["clone","d3-ease","d3-hierarchy","prop-types","react","core-js/fn/array/find","core-js/fn/object/assign"],t):(e=e||self).ReactTreeGraph=t(e.clone,e.d3,e.d3,e.PropTypes,e.React)}(this,function(a,e,p,t,u){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(s){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},t=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(e){var t,r,n;t=s,n=i[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n})}return s}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?s(e):t}var y={source:t.object.isRequired,target:t.object.isRequired,keyProp:t.string.isRequired,x1:t.number.isRequired,x2:t.number.isRequired,y1:t.number.isRequired,y2:t.number.isRequired,pathProps:t.object.isRequired};var g=function(e){function r(e){var t;return i(this,r),(t=f(this,h(r).call(this,e))).handleClick=t.handleClick.bind(s(s(t))),t.handleRightClick=t.handleRightClick.bind(s(s(t))),t}return d(r,u.PureComponent),o(r,[{key:"handleClick",value:function(e){this.props.pathProps.onClick&&this.props.pathProps.onClick(this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp],e)}},{key:"handleRightClick",value:function(e){this.props.pathProps.onContextMenu&&this.props.pathProps.onContextMenu(this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp],e)}},{key:"render",value:function(){var e,t,r,n,s=(e=this.props.x1,t=this.props.y1,r=this.props.x2,n=this.props.y2,"M".concat(t,",").concat(e,"C").concat((t+n)/2,",").concat(e," ").concat((t+n)/2,",").concat(r," ").concat(n,",").concat(r));return u.createElement("path",c({},this.props.pathProps,{d:s,onClick:this.handleClick,onContextMenu:this.handleRightClick}))}}]),r}();g.propTypes=y;var m={x:t.number.isRequired,y:t.number.isRequired,keyProp:t.string.isRequired,labelProp:t.string.isRequired,offset:t.number.isRequired,radius:t.number.isRequired,circleProps:t.object.isRequired,gProps:t.object.isRequired,textProps:t.object.isRequired},P=function(e){function r(e){var t;return i(this,r),(t=f(this,h(r).call(this,e))).handleClick=t.handleClick.bind(s(s(t))),t.handleRightClick=t.handleRightClick.bind(s(s(t))),t}return d(r,u.PureComponent),o(r,[{key:"handleClick",value:function(e){this.props.gProps.onClick&&this.props.gProps.onClick(this.props[this.props.keyProp],e)}},{key:"handleRightClick",value:function(e){this.props.gProps.onContextMenu&&this.props.gProps.onContextMenu(this.props[this.props.keyProp],e)}},{key:"getTransform",value:function(){return"translate(".concat(this.props.y,", ").concat(this.props.x,")")}},{key:"render",value:function(){return u.createElement("g",c({},this.props.gProps,{transform:this.getTransform(),onContextMenu:this.handleRightClick,onClick:this.handleClick}),u.createElement("circle",c({},this.props.circleProps,{r:this.props.radius})),u.createElement("text",c({},this.props.textProps,{dx:this.props.radius+.5,dy:this.props.offset}),this.props[this.props.labelProp]))}}]),r}();P.propTypes=m;var k={children:t.node,height:t.number.isRequired,keyProp:t.string.isRequired,labelProp:t.string.isRequired,links:t.array.isRequired,nodes:t.array.isRequired,nodeClassName:t.string,nodeOffset:t.number.isRequired,nodeRadius:t.number.isRequired,width:t.number.isRequired,circleProps:t.object.isRequired,gProps:t.object.isRequired,pathProps:t.object.isRequired,svgProps:t.object.isRequired,textProps:t.object.isRequired},b=function(e){function t(){return i(this,t),f(this,h(t).apply(this,arguments))}return d(t,u.PureComponent),o(t,[{key:"render",value:function(){var t=this;return u.createElement("svg",c({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,this.props.links.map(function(e){return u.createElement(g,{key:e.target.data[t.props.keyProp],keyProp:t.props.keyProp,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:l({},t.props.pathProps,e.target.data.pathProps)})}),this.props.nodes.map(function(e){return u.createElement(P,c({key:e.data[t.props.keyProp],keyProp:t.props.keyProp,labelProp:t.props.labelProp,offset:t.props.nodeOffset,radius:t.props.nodeRadius,x:e.x,y:e.y,circleProps:l({},t.props.circleProps,e.data.circleProps),gProps:l({},t.props.gProps,e.data.gProps),textProps:l({},t.props.textProps,e.data.textProps)},e.data))}))}}]),t}();b.propTypes=k;var R={animated:t.bool.isRequired,getChildren:t.func.isRequired,keyProp:t.string.isRequired,links:t.array.isRequired,nodes:t.array.isRequired,duration:t.number.isRequired,easing:t.func.isRequired,steps:t.number.isRequired},v=function(e){function s(e){var t;if(i(this,s),t=f(this,h(s).call(this,e)),e.animated){var r=e.nodes[0].x,n=e.nodes[0].y;t.state={nodes:e.nodes.map(function(e){return l({},e,{x:r,y:n})}),links:e.links.map(function(e){return{source:l({},e.source,{x:r,y:n}),target:l({},e.target,{x:r,y:n})}})}}else t.state={nodes:e.nodes,links:e.links};return t}return d(s,u.PureComponent),o(s,[{key:"componentDidMount",value:function(){this.props.animated&&this.animate(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.nodes===this.props.nodes&&e.links===this.props.links||(e.animated?this.animate(e):this.setState({nodes:e.nodes,links:e.links}))}},{key:"animate",value:function(e){var t=this;clearInterval(this.animation);var r=0,n=this.getAnimationContext(this.state,e);this.animation=setInterval(function(){if(++r===e.steps)return clearInterval(t.animation),t.animation=null,void t.setState({nodes:e.nodes,links:e.links});t.setState(t.calculateNewState(n,r/e.steps))},e.duration/e.steps)}},{key:"getAnimationContext",value:function(r,n){var s=this,e=n.nodes.filter(function(t){return r.nodes.every(function(e){return!s.areNodesSame(t,e)})}).map(function(e){return{base:e,old:s.getClosestAncestor(e,n,r),new:e}}),t=n.nodes.filter(function(t){return r.nodes.some(function(e){return s.areNodesSame(t,e)})}).map(function(t){return{base:t,old:r.nodes.find(function(e){return s.areNodesSame(t,e)}),new:t}}),i=r.nodes.filter(function(t){return n.nodes.every(function(e){return!s.areNodesSame(t,e)})}).map(function(e){return{base:e,old:e,new:s.getClosestAncestor(e,r,n)}}),o=n.links.filter(function(t){return r.links.every(function(e){return!s.areLinksSame(t,e)})}).map(function(e){return{base:e,old:s.getClosestAncestor(e.target,n,r),new:e}}),a=n.links.filter(function(t){return r.links.some(function(e){return s.areLinksSame(t,e)})}).map(function(t){return{base:t,old:r.links.find(function(e){return s.areLinksSame(t,e)}),new:t}}),p=r.links.filter(function(t){return n.links.every(function(e){return!s.areLinksSame(t,e)})}).map(function(e){return{base:e,old:e,new:s.getClosestAncestor(e.target,r,n)}});return{nodes:t.concat(e).concat(i),links:a.concat(o).concat(p)}}},{key:"getClosestAncestor",value:function(e,t,r){for(var n=this,s=e;s;){var i=r.nodes.find(function(e){return n.areNodesSame(s,e)});if(i)return i;s=t.nodes.find(function(e){return(n.props.getChildren(e)||[]).some(function(e){return n.areNodesSame(s,e)})})}return r.nodes[0]}},{key:"areNodesSame",value:function(e,t){return e.data[this.props.keyProp]===t.data[this.props.keyProp]}},{key:"areLinksSame",value:function(e,t){return e.source.data[this.props.keyProp]===t.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===t.target.data[this.props.keyProp]}},{key:"calculateNewState",value:function(e,t){var r=this;return{nodes:e.nodes.map(function(e){return r.calculateNodePosition(e.base,e.old,e.new,t)}),links:e.links.map(function(e){return r.calculateLinkPosition(e.base,e.old,e.new,t)})}}},{key:"calculateNodePosition",value:function(e,t,r,n){return l({},e,{x:this.calculateNewValue(t.x,r.x,n),y:this.calculateNewValue(t.y,r.y,n)})}},{key:"calculateLinkPosition",value:function(e,t,r,n){return{source:l({},e.source,{x:this.calculateNewValue(t.source?t.source.x:t.x,r.source?r.source.x:r.x,n),y:this.calculateNewValue(t.source?t.source.y:t.y,r.source?r.source.y:r.y,n)}),target:l({},e.target,{x:this.calculateNewValue(t.target?t.target.x:t.x,r.target?r.target.x:r.x,n),y:this.calculateNewValue(t.target?t.target.y:t.y,r.target?r.target.y:r.y,n)})}}},{key:"calculateNewValue",value:function(e,t,r){return e+(t-e)*this.props.easing(r)}},{key:"render",value:function(){return u.createElement(b,c({},this.props,this.state))}}]),s}();v.propTypes=R;var q={data:t.object.isRequired,animated:t.bool.isRequired,children:t.node,duration:t.number.isRequired,easing:t.func.isRequired,steps:t.number.isRequired,height:t.number.isRequired,width:t.number.isRequired,keyProp:t.string.isRequired,labelProp:t.string.isRequired,getChildren:t.func.isRequired,margins:t.shape({bottom:t.number.isRequired,left:t.number.isRequired,right:t.number.isRequired,top:t.number.isRequired}).isRequired,nodeOffset:t.number.isRequired,nodeRadius:t.number.isRequired,circleProps:t.object.isRequired,gProps:t.object.isRequired,pathProps:t.object.isRequired,svgProps:t.object.isRequired,textProps:t.object.isRequired},x={animated:!1,duration:500,easing:e.easeQuadOut,getChildren:function(e){return e.children},steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeOffset:3.5,nodeRadius:5,circleProps:{},gProps:{className:"node"},pathProps:{className:"link"},svgProps:{},textProps:{}},C=function(e){function t(){return i(this,t),f(this,h(t).apply(this,arguments))}return d(t,u.PureComponent),o(t,[{key:"render",value:function(){var t=this,e=this.props.width-this.props.margins.left-this.props.margins.right,r=this.props.height-this.props.margins.top-this.props.margins.bottom,n=p.hierarchy(a(this.props.data),this.props.getChildren),s=p.tree().size([r,e])(n),i=s.descendants(),o=s.links();return i.forEach(function(e){e.y+=t.props.margins.top}),u.createElement(v,{animated:this.props.animated,duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,links:o,nodes:i,nodeOffset:this.props.nodeOffset,nodeRadius:this.props.nodeRadius,steps:this.props.steps,width:this.props.width,circleProps:this.props.circleProps,gProps:this.props.gProps,pathProps:this.props.pathProps,svgProps:this.props.svgProps,textProps:this.props.textProps},this.props.children)}}]),t}();return C.propTypes=q,C.defaultProps=x,C});
